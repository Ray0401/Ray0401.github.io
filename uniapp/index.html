<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>Uniapp 5+项目重构分享 | xuhairui's blog</title><meta name="description" content="hello">
    <link rel="preload" href="/assets/js/runtime~app.3701f8ad.js" as="script"><link rel="preload" href="/assets/css/styles.113454fc.css" as="style"><link rel="preload" href="/assets/js/567.ff38b5b2.js" as="script"><link rel="preload" href="/assets/js/app.54e3ef76.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.113454fc.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">xuhairui&#39;s blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">关于我</p><ul class=""><li><!--[--><a href="/my/" class="nav-link sidebar-item" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">js高级</p><ul class=""><li><!--[--><a href="/js-advanced/%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-item" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/this.html" class="nav-link sidebar-item" aria-label="this 的理解"><!--[--><!--]--> this 的理解 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.html" class="nav-link sidebar-item" aria-label="事件循环机制（event loop）"><!--[--><!--]--> 事件循环机制（event loop） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98.html" class="nav-link sidebar-item" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE.html" class="nav-link sidebar-item" aria-label="原型与原型链"><!--[--><!--]--> 原型与原型链 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E7%BB%A7%E6%89%BF.html" class="nav-link sidebar-item" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-item" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E6%89%8B%E5%86%99%E6%BA%90%E7%A0%81.html" class="nav-link sidebar-item" aria-label="手写源码以及实现各种功能"><!--[--><!--]--> 手写源码以及实现各种功能 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">路由</p><ul class=""><li><!--[--><a href="/router/" class="nav-link sidebar-item" aria-label="前端路由"><!--[--><!--]--> 前端路由 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">vue</p><ul class=""><li><!--[--><a href="/vue/vue2.html" class="nav-link sidebar-item" aria-label="vue2"><!--[--><!--]--> vue2 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/vue/vue3.html" class="nav-link sidebar-item" aria-label="vue3"><!--[--><!--]--> vue3 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">react</p><ul class=""><li><!--[--><a href="/react/" class="nav-link sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/react/react.html" class="nav-link sidebar-item" aria-label="正篇"><!--[--><!--]--> 正篇 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/react/hooks.html" class="nav-link sidebar-item" aria-label="hooks"><!--[--><!--]--> hooks <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">vite</p><ul class=""><li><!--[--><a href="/vite/" class="nav-link sidebar-item" aria-label="为什么选 vite"><!--[--><!--]--> 为什么选 vite <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/vite/debug.html" class="nav-link sidebar-item" aria-label="debug 源码"><!--[--><!--]--> debug 源码 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">node</p><ul class=""><li><!--[--><a href="/node/node.html" class="nav-link sidebar-item" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">electron</p><ul class=""><li><!--[--><a href="/electron/" class="nav-link sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/electron/start.html" class="nav-link sidebar-item" aria-label="正篇"><!--[--><!--]--> 正篇 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">工程化</p><ul class=""><li><!--[--><a href="/engineering/webpack.html" class="nav-link sidebar-item" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/engineering/babel.html" class="nav-link sidebar-item" aria-label="babel"><!--[--><!--]--> babel <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/engineering/multirepo&amp;monorepo.html" class="nav-link sidebar-item" aria-label="multi-repo &amp; mono-repo"><!--[--><!--]--> multi-repo &amp; mono-repo <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Uniapp</p><ul class=""><li><!--[--><a aria-current="page" href="/uniapp/" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Uniapp 5+项目重构分享"><!--[--><!--]--> Uniapp 5+项目重构分享 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/#为什么重构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="为什么重构:"><!--[--><!--]--> 为什么重构: <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#重构过程" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="重构过程:"><!--[--><!--]--> 重构过程: <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/#开发模版选用" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="开发模版选用"><!--[--><!--]--> 开发模版选用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#目录结构" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="目录结构"><!--[--><!--]--> 目录结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#ts" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ts"><!--[--><!--]--> ts <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#uniapp-如何实现响应式" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="uniapp 如何实现响应式"><!--[--><!--]--> uniapp 如何实现响应式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#vue3" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="vue3"><!--[--><!--]--> vue3 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#vite" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="vite"><!--[--><!--]--> vite <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#http-拦截" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="http 拦截"><!--[--><!--]--> http 拦截 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#主题切换" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="主题切换"><!--[--><!--]--> 主题切换 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#pinia" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="pinia"><!--[--><!--]--> pinia <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#hooks" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="hooks"><!--[--><!--]--> hooks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/#app-调试器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="app 调试器"><!--[--><!--]--> app 调试器 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="uniapp-5-项目重构分享" tabindex="-1"><a class="header-anchor" href="#uniapp-5-项目重构分享" aria-hidden="true">#</a> Uniapp 5+项目重构分享</h1><h2 id="为什么重构" tabindex="-1"><a class="header-anchor" href="#为什么重构" aria-hidden="true">#</a> 为什么重构:</h2><ol><li>template 重复书写,未考虑到扩展性; <img src="/images/uniapp/img3.png" alt=""></li><li>公共 css 未做抽离,每个组件都需要写一遍;</li><li>黑白主题实现方式复杂,需要每个页面对两种主题进行 css 编写 <img src="/images/uniapp/img1.png" alt=""></li><li>组件未进行复用,一个下拉框功能便是一个组件 <img src="/images/uniapp/img2.png" alt=""></li><li>未严格判断数据类型,以及接口数据处理不当 <img src="/images/uniapp/img4.png" alt=""></li><li>http 拦截器逻辑混乱</li><li>options api 的通用毛病,以及 mixin 的滥用</li><li>使用了 loadsh 等大库,还未做按需引入,只是为了使用其中的防抖函数</li><li>uni_modules 里有很多无效组件</li><li>启动项目较慢</li><li>线上出现问题,没办法像浏览器一样查看调试器,排查问题低效</li></ol><p>...</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><em>在开发过程中上述的问题造成了很多心智负担,项目也越来越臃肿,代码质量也越来越差;遂在 v1.0.3 提测后,进行项目重构,便于后期迭代以及多人协作开发同时也对项目制定了更严格的开发规范(husky + commitlint + prettier)</em></p></div><h2 id="重构过程" tabindex="-1"><a class="header-anchor" href="#重构过程" aria-hidden="true">#</a> 重构过程:</h2><p>vue3+vite+ts+pinia</p><h3 id="开发模版选用" tabindex="-1"><a class="header-anchor" href="#开发模版选用" aria-hidden="true">#</a> 开发模版选用</h3><p>1.创建最新的 cli 工程 2.manifeset.json 中再对 app 打包进行配置</p><p>这样一个 5+项目都搭建好了</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>npx degit dcloudio/uni-preset-vue<span class="token comment">#vite-ts my-vue3-project</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构" aria-hidden="true">#</a> 目录结构</h3><h3 id="ts" tabindex="-1"><a class="header-anchor" href="#ts" aria-hidden="true">#</a> ts</h3><ul><li>d.ts 文件是什么</li><li>如何处理 npm 包以及其他 js 文件 (declare module)</li><li>interface</li><li>json to ts</li><li>接口 promise 处理</li></ul><h3 id="uniapp-如何实现响应式" tabindex="-1"><a class="header-anchor" href="#uniapp-如何实现响应式" aria-hidden="true">#</a> uniapp 如何实现响应式</h3><p>page-meta</p><h3 id="vue3" tabindex="-1"><a class="header-anchor" href="#vue3" aria-hidden="true">#</a> vue3</h3><ul><li>provide 与 inject</li><li>ref 与 defineExpose 结合</li><li>自定义组件的双向数据绑定</li><li>自定义 button 组件</li></ul><h3 id="vite" tabindex="-1"><a class="header-anchor" href="#vite" aria-hidden="true">#</a> vite</h3><h3 id="http-拦截" tabindex="-1"><a class="header-anchor" href="#http-拦截" aria-hidden="true">#</a> http 拦截</h3><ul><li>url 管理</li><li>接口 api 管理</li><li>接口 URL 参数处理</li></ul><h3 id="主题切换" tabindex="-1"><a class="header-anchor" href="#主题切换" aria-hidden="true">#</a> 主题切换</h3><ul><li>:root 中定义变量</li></ul><h3 id="pinia" tabindex="-1"><a class="header-anchor" href="#pinia" aria-hidden="true">#</a> pinia</h3><ul><li>无 mutation</li><li>数据持久化</li></ul><h3 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> hooks</h3><p>vue3 借鉴 react hooks 开发出了 Composition API ，所以也就意味着 Composition API 也能进行自定义封装 hooks。</p><p>vue3 中的 hooks 就是函数的一种写法，就是将文件的一些单独功能的 js 代码进行抽离出来，放到单独的 js 文件中，或者说是一些可以复用的公共方法/功能。其实 hooks 和 vue2 中的 mixin 有点类似，但是相对 mixins 而言， hooks 更清楚复用功能代码的来源, 更清晰易懂。</p><h3 id="app-调试器" tabindex="-1"><a class="header-anchor" href="#app-调试器" aria-hidden="true">#</a> app 调试器</h3><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.3701f8ad.js" defer></script><script src="/assets/js/567.ff38b5b2.js" defer></script><script src="/assets/js/app.54e3ef76.js" defer></script>
  </body>
</html>
